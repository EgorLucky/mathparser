<meta charset="utf8">
<textarea id="parametersJson"></textarea>
<textarea id = "expressionInputElement"></textarea>
<button  onclick = "computeButtonClicked()">Посчитать</button>

<p id = "resultTextElement"></p>

<script>
    function computeButtonClicked()
    {
        var textarea = document.getElementById("expressionInputElement");
        var parameterTextArea = document.getElementById("parametersJson");
        requestfinished = function()
        {
            var resultTextElement = document.getElementById("resultTextElement");
            var responseObj = JSON.parse(this.responseText);
            if(this.status == 200)
            {
                resultTextElement.innerText = responseObj.result;
            }
            else
            {
                resultTextElement.innerText = "Ошибка! Ответ от сервера: " + responseObj.message;
            }
        };

        sendRequestToComputeExpression(textarea.value, JSON.parse(parameterTextArea.value), requestfinished);
    }

    function sendRequestToComputeExpression(expression, parameters,  requestFinishedDelegate)
    {
        var xhr = new XMLHttpRequest();

        xhr.open("post", "/api/math/computeExpression", true);

        xhr.onload = requestFinishedDelegate;

        var payload = { expression: expression, parameters: parameters };

        payloadString = JSON.stringify(payload);
        xhr.setRequestHeader("content-type", "application/json");
        xhr.send(payloadString);
    }
</script>